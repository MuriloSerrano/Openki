<template name="messenger">
	<div class="container">
		<div class="messenger">
			<div class="messenger-sidebar">
				{{#each conversation in conversations}}
					{{> sidebar_conversation conversation}}
				{{/each}}
			</div>
			<div class="messenger-panel">
				{{#if activeConversation}}
					{{> full_conversation activeConversation}}
				{{/if}}
			</div>
		</div>
	</div>
</template>

<template name="sidebar_conversation">
	<div class="messenger-sidebar-element conversation-small js-show-conversation {{stateClasses}}">
		<div class="conversation-small-title">
			{{#each user in otherParticipants}}
				{{username user.id}}
			{{/each}}
			{{#if unread}}
				<span class="badge badge-unseen {{#if isMutedByUser}}is-muted{{/if}}">
					{{unread}}
				</span>
			{{/if}}
		</div>
		<div class="conversation-small-teaser">
			<div class="teaser-message">
				<span class="teaser-message-sender">
					{{username message.sender}}:
				</span>
				{{message.content}}
			</div>
			<div class="teaser-message-time">
				{{#if isADayAgo message.timeCreated}}
					{{dateformat message.timeCreated}}
				{{else}}
					{{timeformat message.timeCreated}}
				{{/if}}
			</div>
		</div>
	</div>
</template>

<template name="full_conversation">
	<div class="full-conversation-header">
		<div class="full-conversation-return">
			<button class="btn-link" type="button">
				<i class="fa fa-chevron-left js-show-sidebar" aria-hidden="true"></i>
			</button>
		</div>
		<div class="full-conversation-header-title">
			{{#each user in otherParticipants}}
				{{> profilelink user.id}}
			{{/each}}
		</div>
		<div class="full-conversation-header-options">
			<div class="dropdown">
				<button class="btn-link dropdown-toggle" aria-expanded="false" data-toggle="dropdown">
					<i class="fa fa-bars" aria-hidden="true"></i>
				</button>
				<ul class="dropdown-menu dialog-dropdown right">
					<li class="dropdown-header">
						Options
						<button class="close">&times;</button>
					</li>
					<li role="separator" class="divider"></li>
					<li class="dialog-dropdown-btn">
						<button class="btn btn-default js-toggle-mute" type="button">
							{{#if muted}}
								<i class="fa fa-volume-up fa-fw"></i>
								Unmute conversation
							{{else}}
								<i class="fa fa-volume-off fa-fw"></i>
								Mute conversation
							{{/if}}
						</button>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div class="full-conversation-body">
		{{#each message in messages}}
			{{> full_conversation_message message}}
		{{/each}}
	</div>
	<div class="full-conversation-write js-mark-as-read">
		<!-- TODO use form -->
		<div class="input-group">
			<input class="form-control js-message-content" type="text" placeholder="Write your message">
			<span class="input-group-btn">
				<button class="btn btn-primary js-send-message" type="button">Send</button>
			</span>
		</div>
	</div>
</template>

<template name="full_conversation_message">
	<div class="full-conversation-message {{stateClasses}}">
		<div class="full-conversation-message-body">
			{{content}}
			<div class="full-conversation-message-time">
				{{timeformat timeCreated}} {{dateformat timeCreated}}
			</div>
		</div>
	</div>
</template>
